# Check if uv is available
if ! command -v uv &> /dev/null; then
  echo ""
  echo "âŒ ERROR: uv is not installed"
  echo ""
  echo "uv is required for development. Install it:"
  echo ""
  echo "  macOS:   brew install uv"
  echo "  Windows: winget install astral-sh.uv"
  echo "  Linux:   curl -LsSf https://astral.sh/uv/install.sh | sh"
  echo ""
  echo "Then run: uv sync"
  echo ""
  exit 1
fi

# Check if .venv exists, if not run uv sync with dev dependencies
if [ ! -d ".venv" ]; then
  echo "ğŸ“¦ .venv not found, running uv sync..."
  uv sync --group dev
fi

# Check if ruff is installed, if not install dev dependencies
if [ ! -f ".venv/bin/ruff" ]; then
  echo "ğŸ“¦ ruff not found, installing dev dependencies..."
  uv sync --group dev
fi

# Fix permissions on .venv/bin if needed (common issue on some systems)
if [ -d ".venv/bin" ] && [ ! -x ".venv/bin/ruff" ] 2>/dev/null; then
  echo "ğŸ”§ Fixing .venv permissions..."
  chmod -R +x .venv/bin/
fi

npx lint-staged
