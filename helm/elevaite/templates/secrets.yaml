# =============================================================================
# Secrets Template (DISABLED BY DEFAULT)
# =============================================================================
# In production, secrets are created externally via:
# - CI/CD pipelines (kubectl create secret)
# - Sealed Secrets
# - External Secrets Operator
# - HashiCorp Vault
#
# This template is disabled by default. To enable for local development:
# Set .Values.secrets.create = true in your values file
# =============================================================================

{{- if .Values.secrets.create }}
---
apiVersion: v1
kind: Secret
metadata:
  name: elevaite-db-credentials
  labels:
    {{- include "elevaite.labels" . | nindent 4 }}
type: Opaque
stringData:
  POSTGRES_USER: {{ .Values.secrets.postgresql.user | default "elevaite" | quote }}
  POSTGRES_PASSWORD: {{ required "secrets.postgresql.password is required when secrets.create is true" .Values.secrets.postgresql.password | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: elevaite-rabbitmq-credentials
  labels:
    {{- include "elevaite.labels" . | nindent 4 }}
type: Opaque
stringData:
  RABBITMQ_USER: {{ .Values.secrets.rabbitmq.user | default "elevaite" | quote }}
  RABBITMQ_PASSWORD: {{ required "secrets.rabbitmq.password is required when secrets.create is true" .Values.secrets.rabbitmq.password | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: elevaite-storage-credentials
  labels:
    {{- include "elevaite.labels" . | nindent 4 }}
type: Opaque
stringData:
  AWS_ACCESS_KEY_ID: {{ .Values.secrets.storage.accessKey | default "" | quote }}
  AWS_SECRET_ACCESS_KEY: {{ .Values.secrets.storage.secretKey | default "" | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: elevaite-secrets
  labels:
    {{- include "elevaite.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- range $key, $value := .Values.secrets.app }}
  {{ $key }}: {{ $value | quote }}
  {{- end }}
{{- end }}
